# Mô hình triển khai

```sh
                          +-----------+-----------+
                          |        [Haproxy]      |
                          |         Haproxy       |
                          |         Apache2       | 
                          |                       |
                          |                       | 
                          |                       |
                          +-----------+-----------+    
                                      |
                                      |
                                      | 
                        +----------------------------+
                        |                            |              
                        |                            |    
            +-----------+-----------+    +-----------+-----------+ 
            |        [redis1]       |    |        [redis2]       | 
            |        apache2        +    +         apache2       + 
            |        wordpress      |    |        wordpress      | 
            |      mysql-server     |    |       mysql-client    |   
            |         redis         |    |          redis        |  
            |                       |    |                       |  
            +-----------+-----------+    +-----------------------+   

```

### Install redis

```sh
root@quynv-redis01:~# curl -fsSL https://packages.redis.io/gpg | gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg
root@quynv-redis01:~# echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/redis.list
root@quynv-redis01:~# apt-get update
root@quynv-redis01:~# apt-get install redis -y
```

### Install Apache2

```sh
root@quynv-redis01:~# apt install apache2 -y
```

### Install mysql-server

```sh
root@quynv-redis01:~# apt install mysql-server -y
```
### Install php

```sh
root@quynv-redis01:~# apt install php libapache2-mod-php php-mysql php-curl php-gd php-mbstring php-xml php-xmlrpc php-soap php-intl php-zip -y
```

### Creating a MySQL Database and User for WordPress

```sh
root@quynv-redis01:~# mysql

mysql> CREATE USER 'wordpressuser'@'%' IDENTIFIED WITH mysql_native_password BY 'lean15998';
Query OK, 0 rows affected (0.02 sec)

mysql> GRANT ALL ON wordpress.* TO 'wordpressuser'@'%';
Query OK, 0 rows affected (0.03 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.01 sec)

mysql> EXIT;
Bye
```

### Adjusting Apache’s Configuration to Allow for .htaccess Overrides and Rewrites

```sh
root@quynv-redis01:~# mkdir /var/www/wordpress
root@quynv-redis01:~# chown -R www-data:www-data /var/www/wordpress
root@quynv-redis01:~# vim /etc/apache2/sites-available/wordpress.conf 

...
<VirtualHost *:80>

	ServerName wordpress
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/wordpress
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
  
</VirtualHost>

<Directory /var/www/wordpress/>
        AllowOverride All
</Directory>
```

### Enabling the Rewrite Module

```sh
root@quynv-redis01:~# a2enmod rewrite
Enabling module rewrite.
To activate the new configuration, you need to run:
  systemctl restart apache2
root@quynv-redis01:~# systemctl restart apache2
```

### Enabling the Changes

```sh
root@quynv-redis01:~# apache2ctl configtest
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 10.5.10.193. Set the 'ServerName' directive globally to suppress this message
Syntax OK
root@quynv-redis01:~# systemctl restart apache2
```
### Downloading WordPress

```sh
root@quynv-redis01:~# cd /tmp
root@quynv-redis01:/tmp# curl -O https://wordpress.org/latest.tar.gz
root@quynv-redis01:/tmp# tar xzvf latest.tar.gz
root@quynv-redis01:/tmp# touch /tmp/wordpress/.htaccess
root@quynv-redis01:/tmp# cp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php
root@quynv-redis01:/tmp# mkdir /tmp/wordpress/wp-content/upgrade
root@quynv-redis01:/tmp# sudo cp -a /tmp/wordpress/. /var/www/wordpress
```

###  Configuring the WordPress Directory

```sh
root@quynv-redis01:/tmp# curl -s https://api.wordpress.org/secret-key/1.1/salt/
define('AUTH_KEY',         '-j%!)!1gjj?Gz_ZnfSTynz/yB)-lzt.S5 |bPR2ba?zcq{|+2j+ T=$A*@~[F)Dd');
define('SECURE_AUTH_KEY',  'v4,%b5a|ORfNy4W=j+Y;xz^Z3eTlENOb(-G@4=Cb}Vlnvp|?PS(o@U])7=,]-k,I');
define('LOGGED_IN_KEY',    'fb&~-rF^2i6|y*H48| (:b&k+4NW/v(/7P:(T)<jkOp=S7-oJ>+T&l5,CiZXVa!{');
define('NONCE_KEY',        '0a,Pdf F2^HPN%<xbYTh-b(@xTRlqKGAnLczSf2sHi|##;:Zb#dHbqS&Ubc+>+3)');
define('AUTH_SALT',        '=$Lxxent8J&zy$.81u{<I5FVr#*lRK3+IA8sIGZq<GM,mm&AkFjK2A7w-rA^>Pjp');
define('SECURE_AUTH_SALT', '^t)*VGYt`8#b(&jh+$h9W.}+B+svxl[(asT|1II`r[-$p[4bbB+NfMC[~=}J,fe)');
define('LOGGED_IN_SALT',   'u^dw/4+D&ec _mN kU5w`U^X/O%7AS+e>l|fr6M@`cW+cy.R0V*y-OKCI[OJL)X&');
define('NONCE_SALT',       '@` aBV`C`T~pNEJjX:/K4xF^,&,FW]BG0csr(A_|csUckaZH*l1LPPh$d+>l}Xlv');
```

```sh
root@quynv-redis01:/tmp# vim /var/www/wordpress/wp-config.php

...
/** Database username */
define( 'DB_USER', 'wordpressuser' );

/** Database password */
define( 'DB_PASSWORD', 'lean15998' );

/** Database hostname */
define( 'DB_HOST', 'localhost' );


define('AUTH_KEY',         '-j%!)!1gjj?Gz_ZnfSTynz/yB)-lzt.S5 |bPR2ba?zcq{|+2j+ T=$A*@~[F)Dd');
define('SECURE_AUTH_KEY',  'v4,%b5a|ORfNy4W=j+Y;xz^Z3eTlENOb(-G@4=Cb}Vlnvp|?PS(o@U])7=,]-k,I');
define('LOGGED_IN_KEY',    'fb&~-rF^2i6|y*H48| (:b&k+4NW/v(/7P:(T)<jkOp=S7-oJ>+T&l5,CiZXVa!{');
define('NONCE_KEY',        '0a,Pdf F2^HPN%<xbYTh-b(@xTRlqKGAnLczSf2sHi|##;:Zb#dHbqS&Ubc+>+3)');
define('AUTH_SALT',        '=$Lxxent8J&zy$.81u{<I5FVr#*lRK3+IA8sIGZq<GM,mm&AkFjK2A7w-rA^>Pjp');
define('SECURE_AUTH_SALT', '^t)*VGYt`8#b(&jh+$h9W.}+B+svxl[(asT|1II`r[-$p[4bbB+NfMC[~=}J,fe)');
define('LOGGED_IN_SALT',   'u^dw/4+D&ec _mN kU5w`U^X/O%7AS+e>l|fr6M@`cW+cy.R0V*y-OKCI[OJL)X&');
define('NONCE_SALT',       '@` aBV`C`T~pNEJjX:/K4xF^,&,FW]BG0csr(A_|csUckaZH*l1LPPh$d+>l}Xlv');
```



















