# Mô hình triển khai

```sh
                          +-----------+-----------+
                          |        [Haproxy]      |
                          |         Haproxy       |
                          |         Apache2       | 
                          |                       |
                          |                       | 
                          |                       |
                          +-----------+-----------+    
                                      |
                                      |
                                      | 
                        +----------------------------+
                        |                            |              
                        |                            |    
            +-----------+-----------+    +-----------+-----------+ 
            |        [redis1]       |    |        [websv2]       | 
            |        apache2        +    +         apache2       + 
            |        wordpress      |    |        wordpress      | 
            |      mysql-server     |    |      mysql-client     |   
            |         redis         |    |      redis-client     |  
            |                       |    |                       |  
            +-----------+-----------+    +-----------------------+   

```

# Trên redis1

### Install redis

```sh
root@quynv-redis01:~# curl -fsSL https://packages.redis.io/gpg | gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg
root@quynv-redis01:~# echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/redis.list
root@quynv-redis01:~# apt-get update
root@quynv-redis01:~# apt-get install redis -y
```

### Configure redis

```sh
root@quynv-redis01:~# vim /etc/redis/redis.conf

...
bind 10.5.10.193 -::1
```

### Test redis

```sh
root@quynv-redis01:~# redis-server 
3131746:C 19 Apr 2022 10:49:44.498 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
3131746:C 19 Apr 2022 10:49:44.498 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=3131746, just started
3131746:C 19 Apr 2022 10:49:44.499 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
3131746:M 19 Apr 2022 10:49:44.500 * Increased maximum number of open files to 10032 (it was originally set to 1024).
3131746:M 19 Apr 2022 10:49:44.500 * monotonic clock: POSIX clock_gettime
3131746:M 19 Apr 2022 10:49:44.500 # Warning: Could not create server TCP listening socket *:6379: bind: Address already in use
3131746:M 19 Apr 2022 10:49:44.500 # Failed listening on port 6379 (TCP), aborting.
root@quynv-redis01:~# redis-cli -h 10.5.10.193
10.5.10.193:6379>
```


### Install Apache

```sh
root@quynv-redis01:~# apt install apache2 -y
```

### Install mysql-server

```sh
root@quynv-redis01:~# apt install mysql-server -y
```
### Install php

```sh
root@quynv-redis01:~# apt install php libapache2-mod-php php-mysql php-curl php-gd php-mbstring php-xml php-xmlrpc php-soap php-intl php-zip -y
```

### Creating a MySQL Database and User for WordPress

```sh
root@quynv-redis01:~# mysql

mysql> CREATE USER 'wordpressuser'@'%' IDENTIFIED WITH mysql_native_password BY 'lean15998';
Query OK, 0 rows affected (0.02 sec)

mysql> GRANT ALL ON wordpress.* TO 'wordpressuser'@'%';
Query OK, 0 rows affected (0.03 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.01 sec)

mysql> EXIT;
Bye
```

### Adjusting Apache’s Configuration to Allow for .htaccess Overrides and Rewrites

```sh
root@quynv-redis01:~# mkdir /var/www/wordpress
root@quynv-redis01:~# chown -R www-data:www-data /var/www/wordpress
root@quynv-redis01:~# vim /etc/apache2/sites-available/wordpress.conf 

...
<VirtualHost *:80>

	ServerName wordpress
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/wordpress
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
  
</VirtualHost>

<Directory /var/www/wordpress/>
        AllowOverride All
</Directory>
```

### Enabling the Rewrite Module

```sh
root@quynv-redis01:~# a2enmod rewrite
Enabling module rewrite.
To activate the new configuration, you need to run:
  systemctl restart apache2
root@quynv-redis01:~# systemctl restart apache2
```

### Enabling the Changes

```sh
root@quynv-redis01:~# a2enmod rewrite
root@quynv-redis01:~# apache2ctl configtest
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 10.5.10.193. Set the 'ServerName' directive globally to suppress this message
Syntax OK
root@quynv-redis01:~# systemctl restart apache2
```
### Downloading WordPress

```sh
root@quynv-redis01:~# cd /tmp
root@quynv-redis01:/tmp# curl -O https://wordpress.org/latest.tar.gz
root@quynv-redis01:/tmp# tar xzvf latest.tar.gz
root@quynv-redis01:/tmp# touch /tmp/wordpress/.htaccess
root@quynv-redis01:/tmp# cp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php
root@quynv-redis01:/tmp# mkdir /tmp/wordpress/wp-content/upgrade
root@quynv-redis01:/tmp# sudo cp -a /tmp/wordpress/. /var/www/wordpress
root@quynv-redis01:/tmp# find /var/www/wordpress/ -type d -exec chmod 750 {} \;
root@quynv-redis01:/tmp# find /var/www/wordpress/ -type f -exec chmod 640 {} \;
```

###  Configuring the WordPress Directory

```sh
root@quynv-redis01:/tmp# curl -s https://api.wordpress.org/secret-key/1.1/salt/
define('AUTH_KEY',         '-j%!)!1gjj?Gz_ZnfSTynz/yB)-lzt.S5 |bPR2ba?zcq{|+2j+ T=$A*@~[F)Dd');
define('SECURE_AUTH_KEY',  'v4,%b5a|ORfNy4W=j+Y;xz^Z3eTlENOb(-G@4=Cb}Vlnvp|?PS(o@U])7=,]-k,I');
define('LOGGED_IN_KEY',    'fb&~-rF^2i6|y*H48| (:b&k+4NW/v(/7P:(T)<jkOp=S7-oJ>+T&l5,CiZXVa!{');
define('NONCE_KEY',        '0a,Pdf F2^HPN%<xbYTh-b(@xTRlqKGAnLczSf2sHi|##;:Zb#dHbqS&Ubc+>+3)');
define('AUTH_SALT',        '=$Lxxent8J&zy$.81u{<I5FVr#*lRK3+IA8sIGZq<GM,mm&AkFjK2A7w-rA^>Pjp');
define('SECURE_AUTH_SALT', '^t)*VGYt`8#b(&jh+$h9W.}+B+svxl[(asT|1II`r[-$p[4bbB+NfMC[~=}J,fe)');
define('LOGGED_IN_SALT',   'u^dw/4+D&ec _mN kU5w`U^X/O%7AS+e>l|fr6M@`cW+cy.R0V*y-OKCI[OJL)X&');
define('NONCE_SALT',       '@` aBV`C`T~pNEJjX:/K4xF^,&,FW]BG0csr(A_|csUckaZH*l1LPPh$d+>l}Xlv');
```

```sh
root@quynv-redis01:/tmp# vim /var/www/wordpress/wp-config.php

...
/** Database username */
define( 'DB_USER', 'wordpressuser' );

/** Database password */
define( 'DB_PASSWORD', 'lean15998' );

/** Database hostname */
define( 'DB_HOST', 'localhost' );

define('WP_REDIS_PORT', 6379);
define('WP_REDIS_HOST', '10.5.10.193');

define('AUTH_KEY',         '-j%!)!1gjj?Gz_ZnfSTynz/yB)-lzt.S5 |bPR2ba?zcq{|+2j+ T=$A*@~[F)Dd');
define('SECURE_AUTH_KEY',  'v4,%b5a|ORfNy4W=j+Y;xz^Z3eTlENOb(-G@4=Cb}Vlnvp|?PS(o@U])7=,]-k,I');
define('LOGGED_IN_KEY',    'fb&~-rF^2i6|y*H48| (:b&k+4NW/v(/7P:(T)<jkOp=S7-oJ>+T&l5,CiZXVa!{');
define('NONCE_KEY',        '0a,Pdf F2^HPN%<xbYTh-b(@xTRlqKGAnLczSf2sHi|##;:Zb#dHbqS&Ubc+>+3)');
define('AUTH_SALT',        '=$Lxxent8J&zy$.81u{<I5FVr#*lRK3+IA8sIGZq<GM,mm&AkFjK2A7w-rA^>Pjp');
define('SECURE_AUTH_SALT', '^t)*VGYt`8#b(&jh+$h9W.}+B+svxl[(asT|1II`r[-$p[4bbB+NfMC[~=}J,fe)');
define('LOGGED_IN_SALT',   'u^dw/4+D&ec _mN kU5w`U^X/O%7AS+e>l|fr6M@`cW+cy.R0V*y-OKCI[OJL)X&');
define('NONCE_SALT',       '@` aBV`C`T~pNEJjX:/K4xF^,&,FW]BG0csr(A_|csUckaZH*l1LPPh$d+>l}Xlv');
```






### Trên Web Interface



<img src="https://github.com/lean15998/Redis/blob/main/images/01.png">



<img src="https://github.com/lean15998/Redis/blob/main/images/02.png">



<img src="https://github.com/lean15998/Redis/blob/main/images/03.png">


<img src="https://github.com/lean15998/Redis/blob/main/images/04.png">


<img src="https://github.com/lean15998/Redis/blob/main/images/05.png">

<img src="https://github.com/lean15998/Redis/blob/main/images/06.png">
